# 初识C语言

## 程序与计算机

### 程序是什么

在学习C语言之前，我们先思考：什么是程序

在生活中，假设你要做一碗西红柿鸡蛋面

步骤可能是：

1. 烧水
2. 打鸡蛋
3. 放西红柿
4. 加水煮面

这其实就是一个“程序”

而程序的本质实际上就是

> 一组按照顺序执行的明确指令。

### 计算机如何执行程序

所谓C语言和其他计算机编程语言，都被称之为一门“语言”，而这门语言就是我们要对计算机讲的，计算机听不懂我们的语言，需要我们用他们能听懂的语言说明，计算机便会按照我们所说的严格执行。

更深一点的话，计算机只认识一种东西——二进制的0和1，我们所写的程序会成为二进制的“计算题”，计算机算出答案后再通过可视化的操作返回给我们，最常见的可视化便是从终端返回

终端（Terminal）是用户与计算机系统进行文本交互的界面，终端快速高效且功能强大

### 机器语言与高级语言

最早的程序是直接用二进制写的，这种程序几乎没有可读性，于是出现了汇编语言，类似这样

```SQL
MOV AX, 1
ADD AX, 2
```

这种语言执行效率高，大大增加了可读性，但即便如此，仍然难以编写和维护，学习成本高。

于是便出现了高级语言，我们所学的C语言便是一种编译型高级语言，上面的代码便可以这样表示

```C
int a = 1 + 2;
```

高级语言可以用较简短好理解的方式表示我们的程序，容易编写与维护。

## C语言

C语言诞生于 1970 年代，由 Dennis Ritchie 在贝尔实验室开发。

### C语言的特点

C语言是一种编译型语言，需要用编译器编译成可执行的代码再进行运行

C语言相比其他主流语言，更接近硬件，有以下特点

1. 运行效率高
2. 接近底层
3. 语法简洁
4. 可移植性强

同时也有缺点

- 容易出错
- 内存管理需要手动控制

### C语言标准

C语言标准是对C编程语言的正式规范文档，定义了语法、语义和库函数的行为。它确保不同平台上的C编译器都能以相同方式理解代码，实现代码的可移植性。

C语言在发展过程中形成了多个标准：

- ANSI C（C89）
- C99
- C11
- C18
- C23

本书基于 **C11 标准** 编写。C11标准于2022年发布，

## 编写第一个C程序

现在我们真正写代码：

### Hello World!

在你的编译器新建一个文件：

```
hello.c
```

输入以下内容：

```C
#include <stdio.h>

int main()
{
    printf("Hello, World!\n");
    return 0;
}
```

很好这是你写的第一个完整的代码，这段代码的作用是在终端中打印出Hello, World!

你可以尝试进行编译与运行

若在终端中显示：

![img](https://gcn59lcrd80x.feishu.cn/space/api/box/stream/download/asynccode/?code=MmNmM2I5N2VkYWM4MzJhZTMzZDMwZDc3Yzk0OTBmZGZfZjR2NnFCWDB3STBNWW1RMnBNVXJHYXlMazJrVGxJM21fVG9rZW46RnZGMGJLS3hvb0JXSWN4Mm1MbGNNaEhnbkdnXzE3NzEwNjEyMTM6MTc3MTA2NDgxM19WNA)

则说明你运行成功了，若失败仔细检查代码的字符是否都是英文字符

注意：有作用的代码字符均是英文字符

下面进行简单的解释

```C
#include <stdio.h>                //预处理器找到 stdio.h这个头文件并插入到当前文件

int main()                        //程序的入口，main()表示主函数，int指返回一个整型的值
{
    printf("Hello, World!\n");    //打印("");当中的内容，\n表示换行
    return 0;                     //函数返回了一个0作为返回值
}
```

程序运行时，看到了`#include <stdio.h>`，就会执行stdio.h的内容，使下面的程序有基本的输入输出的功能，接着计算机开始执行我们主函数`main()`的内容，我们将主函数定义为`int`类型，这将会在主函数执行完之后返回一个int类型的值，{}中的内容便是主函数要执行的内容，其中第一行便是printf()，这是一个输出函数，计算机会输出其中的内容，"Hello, World!\n"便是我们输出的内容，这是一串字符，其中\n表示换行，作用和我们日常输入文本时回车的作用一样，可以通过删掉\n再运行观察光标的位置理解。至此，我们成功运行了第一个程序，下面你可以试试在终端中输出This is my second code.或其他内容试试。

对于一门语言，我认为理解它最好的方式就是多使用它编写代码，在相处过程中会一点点了解它的奥秘，下面内容为的是了解工作原理，建议将其作为了解并重心放在后面的代码练习题上

#### 程序是如何从代码变成可执行文件的？

在我们运行 C 程序之前，首先要了解程序是如何从我们写的源代码，经过一系列的处理，最终变成可以运行的可执行文件。很多初学者只知道“编译”这个词，但实际上这个过程涉及多个阶段，而每个阶段都至关重要。

### *程序的整体认知

当我们写好一个 C 程序后，我们实际上只是写了一个 **源代码**，这是程序的初步形态。源代码本身并不能直接运行，因为计算机并不能理解人类编写的高级语言。

计算机只能够理解机器语言（即二进制代码：0 和 1），因此，C 程序的源代码必须经过转换，才能被计算机“看懂”。这个转换过程由一个叫做 **编译器** 的程序来完成。编译器会将我们编写的源代码转换成计算机可以执行的 **机器代码**，并生成一个可执行文件。

#### 从源代码到可执行文件的转换过程

从我们敲下的代码，到计算机最终执行程序，整个过程可以分为以下几个步骤：

##### 预处理

预处理是编译的第一步，主要负责处理以 `#` 开头的预处理指令（比如 `#include`、`#define`）。这些指令不是 C 语言的一部分，而是用于编译过程的辅助工具。

举个例子，`#include <stdio.h>` 指令会告诉编译器去查找并包含 **标准输入输出库**。在预处理阶段，编译器会将这个指令替换为标准库文件的内容。

##### 编译

在预处理之后，编译器会进入真正的编译阶段，将源代码翻译成 **汇编语言**。汇编语言是一种低级语言，比 C 更接近机器语言，但它仍然需要进一步转化。

在这个阶段，编译器会根据源代码的语法和语义，生成目标代码。目标代码通常是一种中间语言，不是机器代码，但它已经包含了大部分程序的指令。

##### 汇编

编译阶段生成的汇编代码会传递给 **汇编器**，汇编器将这些汇编语言转换成二进制机器代码，这些机器代码被保存在一个 **目标文件**（通常扩展名为 `.o`）中。

目标文件仍然不能直接执行，因为它缺少程序运行时需要的一些信息，比如函数和变量的内存地址。

##### 链接

这一步由 **链接器** 来完成。链接器负责将目标文件与程序所依赖的库文件连接起来，形成最终的 **可执行文件**。链接器会处理以下内容：

- 将程序中使用到的外部库（如 `printf` 函数）与其对应的代码链接起来。
- 计算函数和变量在内存中的地址。
- 合并目标文件中的代码段、数据段等，生成一个完整的可执行文件。

这时，我们得到的文件就是一个可以直接在计算机上运行的 **可执行文件**，例如在 Windows 上通常是 `.exe` 后缀的文件，在 Linux 和 macOS 上则是没有扩展名的文件。

#### 运行程序

当我们运行一个 C 程序时，计算机将开始执行该程序中包含的指令。程序的执行过程实际上是对我们在源代码中编写的指令的逐步执行。每个指令告诉计算机做一件具体的事，比如打印一行文字、计算一个数字或修改某个变量的值。

计算机运行程序时会经历以下几个重要步骤：

##### 载入程序

在程序运行之前，操作系统会将可执行文件从硬盘（或者 SSD）加载到内存中。程序的每一部分（如代码、数据等）都会被映射到内存的不同区域。

操作系统还会为程序分配必要的资源，比如 CPU 时间和内存空间，确保程序能顺利执行。

##### 初始化

程序在开始执行时，首先会执行一些初始化操作。这包括：

- 分配和初始化全局变量和静态变量。
- 设置程序所需的资源（如打开文件、分配内存等）。
- 执行 `main` 函数之前的一些系统级初始化工作。

##### 执行指令

一旦初始化完成，程序开始执行 `main` 函数中的指令。这些指令会依次在 CPU 上执行。每一条指令都可能包含数据的计算、变量的修改、条件判断和循环控制等操作。

在执行过程中，程序可能会调用一些函数，操作系统会通过 **栈** 来管理函数的调用和返回。

##### 系统调用与库函数

很多 C 程序会用到系统调用和库函数。系统调用是程序与操作系统之间的接口，例如文件操作、内存管理、进程控制等。而库函数则是标准库（如 `stdio.h`）提供的功能函数，例如 `printf` 和 `scanf`。

在程序运行时，计算机会通过系统调用与操作系统交互，或者调用库函数来完成更复杂的操作。

##### 程序结束

当程序执行完毕后，它会通过 `return 0;` 或其他返回语句退出。在退出时，程序会进行一些清理工作，比如释放内存、关闭打开的文件等。操作系统会收回程序占用的资源，并将 CPU 的控制权交回给操作系统。

##### 错误处理

程序的执行过程中可能会遇到各种错误，比如除零错误、内存溢出等。当发生错误时，操作系统会终止程序的执行，并将错误信息返回给用户。我们在编写程序时需要考虑这些可能的错误，并通过适当的错误处理机制（如 `if` 语句、`try-catch`）来保证程序的健壮性。

#### 运行程序的命令

在编写 C 程序并成功编译后，你就会得到一个可执行文件。我们可以通过命令行或终端运行它。

- 在 Windows 中，我们可以通过双击文件运行，或者在命令行中输入文件名来运行：
- `hello.exe`
- 在 Linux 或 macOS 中，我们通常使用 `./` 来表示当前目录，然后运行程序：
- `./hello`

一旦程序开始运行，你会看到它按预期输出结果（例如 `Hello, World!`）到屏幕上。

#### 程序运行中的输出与输入

大部分 C 程序会与用户交互，它们通过输入和输出进行数据交换。

- **输出**：程序通过函数如 `printf` 输出数据到屏幕，或通过文件输出。
- **输入**：程序可以通过 `scanf` 或从文件中读取数据，获得用户输入的信息。

#### 程序的调试与优化

在编写程序时，我们经常会遇到错误。调试工具（如 `gdb`）能够帮助我们找出程序中的错误所在，分析程序运行时的行为，查看每个变量的值，并逐步执行程序。

一旦程序能正确运行，优化程序的性能也成为一个重要步骤。例如，我们可以通过改进算法、减少内存使用和优化代码结构来提高程序的执行效率。

通过以上过程，我们可以看到程序从编写源代码到执行的整个流程。这不仅让我们理解了程序的执行机制，还能够帮助我们在开发过程中更好地控制程序的运行和调试。

## 代码风格与编程规范

C语言的语法检查相对宽松，有时即使写得很乱也能正常编译与运行，在保证语法不犯错的情况下不同的人都有自己写代码的习惯。本书强烈倡导简洁、清晰、易读的版式（代码风格），版式虽然不影响性能，但十分影响可读性，可读性差的版式的代码可能会给自己或他人造成修改、调试等的困难，难以维护与修改，特别是大的项目、需要多人合作的项目等。对与一个程序员来说，代码风格就像属于自己的书法字体，下面建议的版式是较为清晰流行的版式，但不绝对。

### 空格与缩进规则

#### 空格

空格非常重要，在合适的地方空格会使代码的整洁度提升非常大

| 不清晰的风格            | 清晰的风格                    |
| ----------------------- | ----------------------------- |
| `int a=b+c;`            | `int a = b + c;`              |
| `int a[5]={1,2,3,4,5};` | `int a[5] = {1, 2, 3, 4, 5};` |
| `for(i=1;i<5;i++){}`    | `for(i = 1; i < 5; i++) {}`   |

- `,`之后要留空格，如` int a[5] = {1, 2, 3, 4, 5};`。如果`;`不是一行的结束符号，其后要留空格，如`for(i = 1; i < 5; i++) {}`
- 赋值操作符、比较操作符、算术操作符、逻辑操作符、位域操作符，如`=`、`+=` 、`>=`、`<=`、`+`、`*`、`%`、`&&`、`||`等二元操作符的前后应当加空格。如`int a = b + c;`
- 一元操作符如`!`、`~`、`++`、`--`、`&`等前后不加空格。

#### 空行

空行起着分隔程序段落的作用。合适空行将使程序的布局更加清晰

- 函数内一般将两组分别实现不同功能的代码之间加上空行
- 函数之间一般用空行分隔

### 花括号规则

一般分解符`{`和`}`应独占一行并且位于同一列对齐

```C
int main()
{
    return 0;
}                    //与前一个'{'对齐
```

但if，for，while等控制流的分解符常流行放在关键词后面，这样使代码更简洁但不如上一种分界明确

如：

```C
for(i = 1; i < 5; i++) {
    printf("%d\n", a[i]);
}
```

### 注释

C 语言的注释符为`/*…*/`，行注释一般采用`//…`。注释通常用于：

- 版本、版权声明；
- 函数接口说明；
- 重要的代码行或段落提示。

### 命名规范

在实际应用时，程序应尽量使用具体的单词进行命名，少用无意义的a, b, c等。

- 常见的命名如sum一般表示结果，count一般用来计数，temp用作临时变量等；
- 在场景下定义一个整型的年龄应是`int age;`而不是`int a;`
- 用下划线或首字母大写来进行双单词命名，如`float oldValue;`、`float new_value;`等
- 可以使用_开头的变量区分形参与实参如主函数的`int age`变量在函数中可以用`int _age`传递

## 综合应用

### **1.什么是程序？** 请用通俗的语言解释“程序”在计算机中的定义。

解析：

**程序（Program）就是一组指示计算机执行特定任务的指令序列。**

如果没有程序，计算机（硬件）就是一堆昂贵的金属和塑料，它什么都做不了。程序赋予了计算机“灵魂”，告诉它每一步该做什么。

程序就是人类用计算机能听懂的语言，写给计算机的一封“操作指南”。

### 2.**关于代码中的“注释”：** 编译器会执行注释里的内容吗？写注释的主要目的是什么？

解析：

**编译器不会执行注释里的内容。**

**注释是写给程序员（包括你自己）看的“备忘录”编译器会执行注释里的内容吗和“说明书”，编译器在预处理阶段就会把它扔进垃圾桶，它不影响程序的运行速度和文件大小。**

### 3.**代码缩进与空格的作用：** 在C语言中，不使用缩进（所有代码顶格写）会影响程序运行吗？如果不会，为什么我们还要强调缩进规则？

解析：

在C语言中，不使用缩进（或者缩进乱七八糟）绝对不会影响程序的运行结果。

**缩进的三个关键作用：**

1. **体现层级关系：** 写法 B 通过缩进，一眼就能看出 `printf` 是属于 `if` 管辖的，而 `if` 又是被包裹在 `for` 循环里的。缩进把代码变成了**立体的结构**。
2. **匹配花括号：** C语言用 `{}` 来界定范围。当代码很长时，如果花括号没有对齐（缩进不规范），你经常会遇到“少了一个 `}`”的报错，然后花几个小时去找它是哪一层的。良好的缩进能让你一眼看出括号是否成对。
3. **行业规范与协作：** 程序员有一句名言：**“代码是写给人看的，顺便给机器运行。”** 如果不按缩进规范写代码，在团队合作中会被视为极不专业，甚至导致同事无法维护你的代码。

### 4.**从源代码到可执行文件的四个步骤：** 请按顺序写出程序转换的四个完整步骤（提示：从预处理开始）。

解析：

**预处理**：整理原材料（展开头文件，删注释）。

**编译**：写出施工图纸（转成汇编）。

**汇编**：制造零件（转成二进制目标代码）。

**链接**：组装零件和现成配件（打包成可执行程序）。

### 5.编译与汇编的区别： 编译阶段生成的是什么代码？汇编阶段生成的又是什么文件？

解析：

编译是将“人类逻辑”转化为“硬件指令描述”，而汇编是将“硬件指令描述”转化为“硬件电路信号”。

**编译 (Compilation)** 是从**无**到**有**的创造过程。它把抽象的数学逻辑（C语言）变成了具体的硬件操作步骤（汇编语言）。

**汇编 (Assembly)** 是从**文**到**质**的转换过程。它把记录操作步骤的文字（汇编语言）变成了驱动硬件运行的信号（机器码）。

### 6.**库函数与系统调用的关系：** `printf` 是一个标准库函数，但它最终需要请求操作系统将字符显示在屏幕上。请简述“库函数”与“系统调用”的层级关系。

解析：

库函数是“高层代理”，系统调用是“底层实权者”。

**库函数** ：是运行在用户空间的普通函数，提供高级功能（如格式化、缓冲），是为了**方便程序员**和**提高效率**。

**系统调用**：是操作系统提供的底层接口，是通向硬件的唯一桥梁。

### 7.**程序的初始化：** 在 `main` 函数执行之前，程序完全是一片空白吗？系统是否需要做一些准备工作？

解析：

不是一片空白

**`main`** **函数只是程序员逻辑的起点，而不是计算机执行的起点。** 程序的生命周期有三层：

1. **上层（启动代码）：** 准备内存、处理变量、解析参数。
2. **中间（****`main`** **函数）：** 你写的业务逻辑。
3. **下层（退出代码）：** 当 `main` 返回 `0` 后，启动代码会再次接管，负责清理内存、关闭文件，并把 `0` 这个状态码报告给操作系统。

### 8.错误处理机制：程序运行中可能遇到哪些类型的错误（如运行时错误 vs 逻辑错误）？它们通常是如何被发现的？

解析：

| 错误类型   | 发生时间   | 表现形式           | 发现难度 | 解决方式                     |
| ---------- | ---------- | ------------------ | -------- | ---------------------------- |
| 编译错误   | 编写代码时 | 编译失败，爆红     | ★☆☆☆☆    | 看编译器提示修正语法         |
| 运行时错误 | 程序运行时 | 程序崩溃，闪退     | ★★★☆☆    | 检查指针、数组边界、除数     |
| 逻辑错误   | 程序运行时 | 结果错误，诡异行为 | ★★★★★    | 单步调试，打印日志，代码审查 |

### 9.制作一个“高精度温度转换器”

**场景描述：** 你需要为一款智能温度计编写核心代码。用户会输入一个**摄氏度（Celsius）**，你需要把它转换成华氏度（Fahrenheit）并显示在屏幕上。

**数学公式：**

$$华氏度 = \frac{9}{5} \times 摄氏度 + 32$$

```C
#include <stdio.h>

int main() {
    // 1. 定义变量：必须使用 float 或 double 来存储小数
    float celsius;
    float fahrenheit;

    // 2. 获取输入提示
    printf("请输入摄氏度 (例如 26.5): ");
    scanf("%f", &celsius); // 注意：这里用 %f，而且要加 & 取地址符

    // 3. 计算公式
    // ❌ 错误写法： fahrenheit = (9 / 5) * celsius + 32; 
    // ✅ 正确写法 A：直接写小数 1.8
    // ✅ 正确写法 B：写成 9.0 / 5.0 强制变成浮点运算
    fahrenheit = (9.0 / 5.0) * celsius + 32;

    // 4. 输出结果
    // %.2f 表示保留两位小数
    printf("Temperature: %.2f F\n", fahrenheit);

    return 0;
}
```

![img](https://gcn59lcrd80x.feishu.cn/space/api/box/stream/download/asynccode/?code=NzYwZmI3Mzg3MzZiOTY5ODRiMzZjZTU1MGY4ZjNhMDlfUHY3ZHRDV2k4QjZ6amtxNjJ4M3J3MTRlTXJwQUpERE5fVG9rZW46SGV6TGIwYjZYb0wzZzZ4eDUxeGNWV3NnbmNwXzE3NzEwNjEyMTM6MTc3MTA2NDgxM19WNA)

### 10.时间格式化助手

**场景描述：** 你正在开发一个视频播放器。视频文件的元数据里只记录了视频的总时长是“多少秒”（比如 `3665` 秒），但直接给用户显示 `3665秒` 体验太差了。 你需要写一个程序，把输入的**总秒数**转换成标准的 **“时:分:秒”** 格式。

**要求：**

1. **输入：** 一个整数，代表总秒数（例如 `3665`）。
2. **计算：** 将其转换为对应的小时、分钟和秒。
3. **输出：** 格式必须是 `HH:MM:SS`（时:分:秒）。
	1. *进阶挑战（可选）：* 如果数字小于10，前面需要补0（例如显示 `01:01:05` 而不是 `1:1:5`）。

**测试用例：**

- **输入：** `3600` -> **输出：** `01:00:00` （刚好1小时）

```C++
#include <stdio.h>

int main() {
    // 1. 定义变量：时间都是整数，用 int 即可
    int total_seconds;
    int hours, minutes, seconds;

    // 2. 获取输入
    printf("请输入总秒数 (例如 3665): ");
    scanf("%d", &total_seconds);

    // 3. 核心计算（利用整数除法和取模）
    
    // 计算小时：直接除以3600，C语言会自动舍去余数（比如 3665/3600 = 1）
    hours = total_seconds / 3600;
    
    // 计算分钟：先去掉小时剩下的秒数 (total_seconds % 3600)，再除以60
    // 或者：先算出总分钟数 (total_seconds / 60)，再对60取余
    minutes = (total_seconds % 3600) / 60;
    
    // 计算秒数：直接对60取余，剩下的就是不满一分钟的秒数
    seconds = total_seconds % 60;

    // 4. 格式化输出
    // %02d 的意思是：输出整数，至少占2位，不够的前面补0
    printf("Time: %02d:%02d:%02d\n", hours, minutes, seconds);

    return 0;
}
```

![img](https://gcn59lcrd80x.feishu.cn/space/api/box/stream/download/asynccode/?code=NTBlYjE0Nzk5NTM0ODVkZjkwNzEwN2FhNThmNzVlMzBfZzlaWWVOcGJaNkdjRFVWaEE2dWp5aGRBUU1vcTRYeUdfVG9rZW46Umh3emJLNzl6b3hTQzZ4dG43MGNHN3FibnlQXzE3NzEwNjEyMTM6MTc3MTA2NDgxM19WNA)